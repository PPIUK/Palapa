{"version":3,"sources":["Carousel.tsx"],"names":["Carousel","React","forwardRef","_props","ref","props","data","rawData","loop","mode","style","width","height","vertical","autoPlay","windowSize","autoPlayReverse","autoPlayInterval","scrollAnimationDuration","withAnimation","renderItem","onScrollEnd","onSnapToItem","onScrollBegin","onProgressChange","customAnimation","defaultIndex","commonVariables","size","handlerOffsetX","dataLength","length","offsetX","totalSize","x","value","isNaN","carouselController","disable","originalLength","_onScrollEnd","onChange","i","duration","next","prev","sharedPreIndex","sharedIndex","computedIndex","getCurrentIndex","start","pause","useCallback","current","scrollViewGestureOnScrollBegin","scrollViewGestureOnScrollEnd","scrollViewGestureOnTouchBegin","scrollViewGestureOnTouchEnd","goToIndex","animated","to","useImperativeHandle","scrollTo","visibleRanges","total","viewSize","translation","layoutConfig","renderLayout","item","realIndex","DATA_LENGTH","SINGLE_ITEM","DOUBLE_ITEM","animationValue","index","common","styles","container","itemsVertical","itemsHorizontal","map","StyleSheet","create","overflow","flexDirection"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Animated, { runOnJS, useDerivedValue } from 'react-native-reanimated';\n\nimport { useCarouselController } from './hooks/useCarouselController';\nimport { useAutoPlay } from './hooks/useAutoPlay';\nimport { usePropsErrorBoundary } from './hooks/usePropsErrorBoundary';\nimport { ScrollViewGesture } from './ScrollViewGesture';\nimport { useVisibleRanges } from './hooks/useVisibleRanges';\n\nimport type { ICarouselInstance, TCarouselProps } from './types';\nimport { StyleSheet, View } from 'react-native';\nimport { DATA_LENGTH } from './constants';\nimport { BaseLayout } from './layouts/BaseLayout';\nimport { useLayoutConfig } from './hooks/useLayoutConfig';\nimport { useInitProps } from './hooks/useInitProps';\nimport { CTX } from './store';\nimport { useCommonVariables } from './hooks/useCommonVariables';\nimport { useOnProgressChange } from './hooks/useOnProgressChange';\n\nconst Carousel = React.forwardRef<ICarouselInstance, TCarouselProps<any>>(\n    (_props, ref) => {\n        const props = useInitProps(_props);\n\n        const {\n            data,\n            rawData,\n            loop,\n            mode,\n            style,\n            width,\n            height,\n            vertical,\n            autoPlay,\n            windowSize,\n            autoPlayReverse,\n            autoPlayInterval,\n            scrollAnimationDuration,\n            withAnimation,\n            renderItem,\n            onScrollEnd,\n            onSnapToItem,\n            onScrollBegin,\n            onProgressChange,\n            customAnimation,\n            defaultIndex,\n        } = props;\n\n        const commonVariables = useCommonVariables(props);\n        const { size, handlerOffsetX } = commonVariables;\n        const dataLength = data.length;\n\n        const offsetX = useDerivedValue(() => {\n            const totalSize = size * dataLength;\n            const x = handlerOffsetX.value % totalSize;\n\n            if (!loop) {\n                return handlerOffsetX.value;\n            }\n            return isNaN(x) ? 0 : x;\n        }, [loop, size, dataLength]);\n\n        usePropsErrorBoundary(props);\n        useOnProgressChange({ size, offsetX, rawData, onProgressChange });\n\n        const carouselController = useCarouselController({\n            loop,\n            size,\n            handlerOffsetX,\n            length: data.length,\n            disable: !data.length,\n            withAnimation,\n            originalLength: data.length,\n            defaultIndex,\n            onScrollEnd: () => runOnJS(_onScrollEnd)(),\n            onScrollBegin: () => !!onScrollBegin && runOnJS(onScrollBegin)(),\n            onChange: (i) => !!onSnapToItem && runOnJS(onSnapToItem)(i),\n            duration: scrollAnimationDuration,\n        });\n\n        const {\n            next,\n            prev,\n            sharedPreIndex,\n            sharedIndex,\n            computedIndex,\n            getCurrentIndex,\n        } = carouselController;\n\n        const { start, pause } = useAutoPlay({\n            autoPlay,\n            autoPlayInterval,\n            autoPlayReverse,\n            carouselController,\n        });\n\n        const _onScrollEnd = React.useCallback(() => {\n            computedIndex();\n            onScrollEnd?.(sharedPreIndex.current, sharedIndex.current);\n        }, [sharedPreIndex, sharedIndex, computedIndex, onScrollEnd]);\n\n        const scrollViewGestureOnScrollBegin = React.useCallback(() => {\n            pause();\n            onScrollBegin?.();\n        }, [onScrollBegin, pause]);\n\n        const scrollViewGestureOnScrollEnd = React.useCallback(() => {\n            start();\n            _onScrollEnd();\n        }, [_onScrollEnd, start]);\n\n        const scrollViewGestureOnTouchBegin = React.useCallback(pause, [pause]);\n\n        const scrollViewGestureOnTouchEnd = React.useCallback(start, [start]);\n\n        const goToIndex = React.useCallback(\n            (i: number, animated?: boolean) => {\n                carouselController.to(i, animated);\n            },\n            [carouselController]\n        );\n\n        React.useImperativeHandle(\n            ref,\n            () => ({\n                next,\n                prev,\n                getCurrentIndex,\n                goToIndex,\n                scrollTo: carouselController.scrollTo,\n            }),\n            [\n                getCurrentIndex,\n                goToIndex,\n                next,\n                prev,\n                carouselController.scrollTo,\n            ]\n        );\n\n        const visibleRanges = useVisibleRanges({\n            total: data.length,\n            viewSize: size,\n            translation: handlerOffsetX,\n            windowSize,\n        });\n\n        const layoutConfig = useLayoutConfig({ ...props, size });\n\n        const renderLayout = React.useCallback(\n            (item: any, i: number) => {\n                let realIndex = i;\n                if (rawData.length === DATA_LENGTH.SINGLE_ITEM) {\n                    realIndex = i % 1;\n                }\n\n                if (rawData.length === DATA_LENGTH.DOUBLE_ITEM) {\n                    realIndex = i % 2;\n                }\n\n                return (\n                    <BaseLayout\n                        key={i}\n                        index={i}\n                        handlerOffsetX={offsetX}\n                        visibleRanges={visibleRanges}\n                        animationStyle={customAnimation || layoutConfig}\n                    >\n                        {({ animationValue }) =>\n                            renderItem({\n                                item,\n                                index: realIndex,\n                                animationValue,\n                            })\n                        }\n                    </BaseLayout>\n                );\n            },\n            [\n                rawData,\n                offsetX,\n                visibleRanges,\n                renderItem,\n                layoutConfig,\n                customAnimation,\n            ]\n        );\n\n        return (\n            <CTX.Provider value={{ props, common: commonVariables }}>\n                <View\n                    style={[\n                        styles.container,\n                        { width: width || '100%', height: height || '100%' },\n                        style,\n                    ]}\n                >\n                    <ScrollViewGesture\n                        size={size}\n                        translation={handlerOffsetX}\n                        onScrollBegin={scrollViewGestureOnScrollBegin}\n                        onScrollEnd={scrollViewGestureOnScrollEnd}\n                        onTouchBegin={scrollViewGestureOnTouchBegin}\n                        onTouchEnd={scrollViewGestureOnTouchEnd}\n                    >\n                        <Animated.View\n                            key={mode}\n                            style={[\n                                styles.container,\n                                {\n                                    width: width || '100%',\n                                    height: height || '100%',\n                                },\n                                style,\n                                vertical\n                                    ? styles.itemsVertical\n                                    : styles.itemsHorizontal,\n                            ]}\n                        >\n                            {data.map(renderLayout)}\n                        </Animated.View>\n                    </ScrollViewGesture>\n                </View>\n            </CTX.Provider>\n        );\n    }\n);\n\nexport default Carousel as <T extends any>(\n    props: React.PropsWithChildren<TCarouselProps<T>>\n) => React.ReactElement;\n\nconst styles = StyleSheet.create({\n    container: {\n        overflow: 'hidden',\n    },\n    itemsHorizontal: {\n        flexDirection: 'row',\n    },\n    itemsVertical: {\n        flexDirection: 'column',\n    },\n});\n"]}